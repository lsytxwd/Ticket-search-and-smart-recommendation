<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>后台界面</title>

<link rel="stylesheet"	href="layui/layui/css/layui.css">
<!--<link rel="stylesheet"	href="layui/laydate/theme/default/laydate.css">-->
<script	src="layui/layui/layui.js"></script>
<!--<script	src="layui/laydate/laydate.js"></script>-->
<script src="jq3.4.1/jquery-1.12.4.min.js"></script>
<script src="jq3.4.1/echarts.min.js"></script>


</head>
<style>
html,body{
	min-width: 1024px;
	 height:100%;
	 overflow: hidden;
}
.layui-tab-item{
	overflow-x: scroll;
}
</style>

<script>

//定义在外面
var table;
var element;
layui.use([  'laypage', 'layer','form', 'table', 'carousel',
			'upload', 'element' ], function() {
	table = layui.table;
	element = layui.element; //元素操作
});

//这个值是由  manage_top.jsp里面的一个显示隐藏的侧边的方法控制
var left_width = 0 ;

//可以从子页面传来个 关闭  由我关闭
function delete_tab_id(id){
	 element.tabDelete('layer_tab', id); //
}

$(function(){
	init_tab_height();
	window.onresize = function(){
		init_tab_height();
	}
});


//遍历选项卡，存在true  不存在false
function for_tab(id){
	add_flag = false;
	$(".layui-tab-title li").each(function(){
		var lay_id = $(this).attr("lay-id");
		console.log(lay_id);
		if(lay_id){
			if(lay_id==id){
				add_flag = true;
			}
		}
	});
	return add_flag;
}

function init_tab_height(){
	var body_width = document.body.offsetWidth;
	layui_tab_item_width = (body_width-left_width);
	console.log("layui_tab_item的宽是:"+layui_tab_item_width);

	//计算layui-tab-item 需要 设置多少的高 顶部的60  layui-tab-title=41
	var body_height = document.body.offsetHeight;
	layui_tab_item_height = (body_height-60-41);
	$(".layui-tab-item").css("height",layui_tab_item_height+"px");
	console.log("layui_tab_item的高是:"+layui_tab_item_height);
}

function addTab(id,title,content){
	//遍历tab 看看这个id是否存在  如果存在直接切换
	var s = for_tab(id);
	if(s){
		element.tabChange('layer_tab', id); //切换到 用户点的
		init_tab_height();
	}else{
		//添加
		element.tabAdd('layer_tab', {
        title: title
        ,content: content
        ,id: id
      });
	element.tabChange('layer_tab', id); //切换到 用户点的
	init_tab_height();
	}
}
</script>

<body>
<div style="display: flex;display: -webkit-flex; flex-direction:column; height: 100%; ">
	<div id="Top" style="height: 60px; width: 100%;">
	</div>

		<div id="main_scroll" style="flex:1;-webkit-flex:1;padding-left: 0px;">
			<div class="layui-tab layui-tab-brief" lay-allowclose="true"  style="margin: 0;"  lay-filter="layer_tab">
				<div  style="background-color: #00F7DE;color: #29b9db;height: 30px;width: 100%;margin-top: 10px">
                    <span style="padding-left: 90px;padding-top: 40px" id="kpl">2020年7月6日北京-纽约</span>
				</div>
				<div class="layui-tab-content" style="margin:0px 10%;height:100%;background-color: #f5f8fa">

				<table class="layui-hide" id="test" lay-filter="test" style="height: 400px"></table>

				<script type="text/html" id="barDemo">
				<a class="layui-btn layui-btn-xs" lay-event="edit" style="display: block;height: 70%;width: 80%">预定</a>
				</script>


				<script>

				var query={
					departureCityName:sessionStorage.getItem("departureCityName"),
					departureDate:sessionStorage.getItem("departureDate"),
					arrivalCityName:sessionStorage.getItem("arrivalCityName"),
					cabinType:sessionStorage.getItem("cabinType"),
					isTransit:sessionStorage.getItem("isTransit"),
					arrivalDate:"null",
					departureAirportName:"null",
					arrivalAirportName:"null",
					airlineName:"null"
				}
				layui.use('table', function(){
				var table = layui.table;

				table.render({
				elem: '#test'
				,url:'http://localhost:8080/searchByQuery'
				,where: {
						query:query
					}
				,defaultToolbar: ['filter', 'exports', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
				title: '提示'
				,layEvent: 'LAYTABLE_TIPS'
				,icon: 'layui-icon-tips'
				}]
				,title: '用户数据表'
				,cols: [[
				{field:'departureAirportName', title:'出发地', width:120, edit: 'text'}
                 ,{field:'flightNumber', title:'航次', width:70, edit: 'text'}
				,{field:'departureDate', title:'出发时间', width:180, edit: 'text', sort: true}
				,{field:'lengthFlight', title:'飞行时长', width:200, edit: 'text', sort: true}
				,{field:'arrivalAirportName', title:'目的地', width:180,edit: 'text'}
				,{field:'arrivalDate', title:'到达时间', width:180,edit: 'text', sort: true}
                ,{field:'price', title:'价格', width:180,edit: 'text', sort: true}
				,{fixed: 'right', title:'操作', toolbar: '#barDemo', width:150}
				]]
				,page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
				layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
				//,curr: 5 //设定初始在第 5 页
				,limit:10
				,groups: 5 //只显示 1 个连续页码
				,first: false //不显示首页
				,last: false //不显示尾页
				}
				});


				//监听行工具事件
				table.on('tool(test)', function(obj){
						var data = obj.data;
//						console.log(data)
						if(obj.event === 'edit'){
							layer.confirm('真的修改行么', function(index){
							console.log(data.titleNum)
							layer.close(index);
						});
						}
						});
					});
				</script>





			</div>
		</div>
	</div>

    	<div id="Foot" style="height: 60px; width: 100%;">
	</div>
</div>

</body>
<script>

	$("#kpl").html(sessionStorage.getItem("departureDate")+"地点："+sessionStorage.getItem("departureCityName")+"-"+sessionStorage.getItem("arrivalCityName"))
    $(function(){
        $("#Top").load("common/top.html")
        $("#Foot").load("common/foot.html")
    })

	layui.use([ 'laydate', 'laypage', 'layer', 'table', 'carousel',
			'upload', 'element' ], function() {
		var laydate = layui.laydate //日期
		, laypage = layui.laypage //分页
		,layer = layui.layer //弹层
		, table = layui.table //表格
		, carousel = layui.carousel //轮播
		, upload = layui.upload //上传
		, element = layui.element; //元素操作

		//监听导航点击
		element.on('nav(left_menu)', function(elem){
			// $(this)
			elem = $(this).parent();

		    var id = $(elem).attr("id");
			var url = $(elem).attr("url");
			var text = $(elem).attr("dd_text");
			var type = $(elem).attr("type");

			console.log(id);
			console.log(url);
			console.log(text);
			console.log(type);
			var content = "<iframe frameborder=0 scrolling='auto' style='width:100%;height:100%' src='"+url+"'></iframe>";


			switch(type){
			  case '0':
				  addTab(id,text,content);
			  break;
				case '1':
					window.open(url);
				  break;
				case '2':
				  //弹出layer 窗口
				  layer.open({
					  type: 2,
					  offset: ['300px', '200px'],
					  title: text,
					  shadeClose: false,
					  shade: 0.8,
					  area: ['500px', '600px'],
					  content: url //iframe的url
				   });
				  break;
			}


		  });

	});
</script>
</html>